#include <Arduino.h>
#include <array>

#define s0 14
#define s1 12
#define s2 13
#define s3 27
#define sig1 35
#define sig2 34
#define sig3 39
#define sig4 36


class Detector
{
    public:
        Detector();
        void scanBoard();
        void displayFigData(const char myArray[][8]);
        void displayIntData(const int myArray[][8]);

    private:
        void clearFigArray(char myArray[][8]);
        void choosePin(int Pin);
        void mapToFigure();
        void getDropDown();
        void scan(bool reference);
        int reading_num = 10;
        

        int referenceValues[8][8] = {{0,0,0,0,0,0,0,0}, // potrzebne do obliczania dropdownu 
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0},
                                    {0,0,0,0,0,0,0,0}};

        int rawValues[8][8] = {{0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0}};
        
        int dropDown[8][8] = {{0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0}};
        

        char figures[8][8] = {{'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'},
                            {'0','0','0','0','0','0','0','0'}};

        int prevFigures[8][8] = {{0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0},
                            {0,0,0,0,0,0,0,0}};

        // tablica kalibracji wartosci dla kazdego czujnika
        int calibration[12][8][8] = {
                    {{1350,1300,1396,1399,1383,1329,1371,1369}, //0
                    {1330,1349,1322,1359,1369,1326,1393,1409},
                    {1367,1358,1362,1382,1371,1280,1379,1378},
                    {1342,1198,1345,1342,1357,1414,1435,1399},
                    {1295,1448,1222,1353,1194,1303,1293,1351},
                    {1360,1297,1345,1339,1383,1281,1348,1231},
                    {1315,1250,1329,1304,1319,1322,1381,1283},
                    {1341,1264,1319,1304,1307,1369,1244,1304}}, 

                    {{1055,944,1064,1084,999,993,1092,1096}, // 0,5
                    {997,922,1189,1008,1060,1074,1187,1192},
                    {1010,1104,1084,1110,1093,1108,1002,1001},
                    {1045,1106,1274,1074,1083,1037,1223,1116},
                    {924,1013,982,1047,986,954,977,1033},
                    {1005,931,942,1026,970,940,981,871},
                    {982,870,1012,1005,993,1010,1039,917},
                    {1096,974,988,912,940,1002,887,967}},

                    {{830,709,816,835,770,764,841,861}, // 1
                    {751,730,914,796,844,817,926,917},
                    {779,834,888,906,853,845,782,783},
                    {817,879,919,767,851,789,931,858},
                    {733,795,749,788,761,721,758,785},
                    {774,722,734,782,745,735,769,702},
                    {766,688,770,776,758,786,784,705},
                    {840,757,750,716,726,783,699,746}},

                    {{565,490,560,578,534,536,574,577}, // 1,5 
                    {523,491,615,525,558,555,628,637},
                    {534,581,617,646,583,576,532,530},
                    {545,592,628,540,573,543,633,604},
                    {505,543,511,536,515,509,519,550},
                    {534,505,496,540,511,501,527,477},
                    {525,476,528,540,514,536,534,488},
                    {560,507,518,507,511,534,478,504}},

                    {{380,325,367,384,356,353,391,400}, // 2
                    {347,343,411,361,378,371,404,426},
                    {353,385,401,413,391,382,364,351},
                    {373,391,418,313,377,361,421,391},
                    {324,353,333,357,341,341,348,366},
                    {352,334,329,359,343,331,347,323},
                    {343,312,353,349,345,359,356,338},
                    {375,336,336,335,332,351,311,346}},

                    {{281,245,275,281,258,261,281,289}, //2,5
                    {253,249,297,265,269,277,306,309},
                    {263,286,303,305,288,274,256,263},
                    {268,300,320,356,279,271,318,281},
                    {251,274,244,263,251,255,261,261},
                    {253,247,247,261,253,251,243,239},
                    {251,236,254,259,251,256,261,234},
                    {277,256,254,242,245,266,221,259}},

                    {{-1293,-1275,-1255,-1233,-1237,-1286,-1270,-1253}, // -0
                    {-1280,-1209,-1357,-1252,-1286,-1332,-1262,-1252}, 
                    {-1261,-1290,-1100,-1108,-1264,-1373,-1249,-1276}, 
                    {-1288,-1443,-1269,-1025,-1294,-1209,-1225,-1243},
                    {-1193,-1136,-1382,-1267,-1400,-1250,-1295,-1250},
                    {-1245,-1131,-1078,-1269,-1166,-1290,-1251,-1319},
                    {-1266,-1212,-1251,-1276,-1256,-1269,-1185,-1266},
                    {-1275,-1313,-1269,-1227,-1248,-1233,-1206,-1273}},

                    {{-1060,-915,-1058,-1064,-1004,-993,-1083,-1106}, // -0,5
                    {-967,-936,-1168,-1028,-1065,-1061,-1173,-1175},
                    {-990,-1083,-1037,-1053,-1090,-1100,-1017,-1017},
                    {-1043,-1124,-1171,-933,-1085,-1022,-1148,-1106},
                    {-919,-997,-960,-1036,-979,-933,-966,-1014},
                    {-1015,-924,-931,-1021,-969,-940,-999,-895},
                    {-991,-869,-1016,-995,-981,-1015,-1018,-907},
                    {-1087,-984,-1003,-915,-945,-995,-890,-978}},

                    {{-777,-675,-774,-764,-732,-717,-790,-814}, // -1
                    {-719,-705,-855,-710,-773,-766,-851,-887},
                    {-703,-799,-806,-858,-791,-788,-723,-711},
                    {-747,-820,-856,-695,-783,-751,-874,-803},
                    {-681,-740,-713,-733,-728,-671,-708,-728},
                    {-736,-674,-691,-732,-701,-664,-733,-656},
                    {-733,-625,-733,-723,-710,-743,-733,-667},
                    {-773,-711,-701,-703,-671,-729,-621,-717}},

                    {{-639,-556,-630,-655,-597,-589,-651,-663}, //-1,5
                    {-596,-575,-704,-612,-631,-624,-688,-727},
                    {-581,-657,-677,-711,-656,-661,-613,-593},
                    {-622,-677,-695,-558,-640,-617,-716,-660},
                    {-568,-598,-581,-601,-599,-570,-590,-600},
                    {-602,-557,-571,-604,-576,-567,-601,-532},
                    {-591,-522,-598,-601,-590,-612,-604,-545},
                    {-634,-591,-593,-573,-556,-595,-526,-585}},

                    {{-422,-369,-418,-443,-396,-397,-422,-435}, //-2
                    {-402,-383,-464,-407,-410,-417,-451,-484},
                    {-394,-449,-443,-461,-435,-431,-403,-393},
                    {-412,-445,-461,-373,-420,-410,-476,-446},
                    {-376,-398,-381,-403,-398,-374,-399,-397},
                    {-403,-370,-383,-398,-374,-361,-393,-368},
                    {-397,-348,-395,-399,-386,-410,-403,-372},
                    {-413,-391,-388,-385,-374,-402,-348,-390}},

                    {{-328,-290,-320,-340,-305,-300,-331,-333}, // -2,5
                    {-307,-303,-313,-315,-314,-324,-340,-365},
                    {-294,-341,-338,-361,-324,-325,-314,-311},
                    {-316,-343,-353,-293,-316,-315,-365,-336},
                    {-294,-305,-282,-304,-304,-276,-299,-296},
                    {-304,-284,-303,-304,-294,-275,-305,-272},
                    {-304,-262,-299,-302,-297,-313,-300,-286},
                    {-313,-302,-302,-304,-280,-305,-267,-306}}
        };

};